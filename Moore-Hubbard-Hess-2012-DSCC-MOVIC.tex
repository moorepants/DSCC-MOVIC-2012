%%%%%%%%%%%%%%%%%%%%%%%%%%% asme2e.tex %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Template for producing ASME-format articles using LaTeX            %
% Written by   Harry H. Cheng                                        %
%              Integration Engineering Laboratory                    %
%              Department of Mechanical and Aeronautical Engineering %
%              University of California                              %
%              Davis, CA 95616                                       %
%              Tel: (530) 752-5020 (office)                          %
%                   (530) 752-1028 (lab)                             %
%              Fax: (530) 752-4158                                   %
%              Email: hhcheng@ucdavis.edu                            %
%              WWW:   http://iel.ucdavis.edu/people/cheng.html       %
%              May 7, 1994                                           %
% Modified: February 16, 2001 by Harry H. Cheng                      %
% Modified: January  01, 2003 by Geoffrey R. Shiflett                %
% Use at your own risk, send complaints to /dev/null                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% use twocolumn and 10pt options with the asme2e format
\documentclass[twocolumn,10pt]{asme2e}

\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{graphicx}

%% The class has several options
%  onecolumn/twocolumn - format for one or two columns per page
%  10pt/11pt/12pt - use 10, 11, or 12 point font
%  oneside/twoside - format for oneside/twosided printing
%  final/draft - format for final/draft copy
%  cleanfoot - take out copyright info in footer leave page number
%  cleanhead - take out the conference banner on the title page
%  titlepage/notitlepage - put in titlepage or leave out titlepage
%
%% The default is oneside, onecolumn, 10pt, final

%% Replace here with information related to your conference
\confshortname{DSCC 2012}
\conffullname{2012 ASME Dynamic Systems and Control Conference}
\confdate{17-19}
\confmonth{October}
\confyear{2012}
\confcity{Fort Lauderdale, Florida}
\confcountry{USA}

%% Replace DETC2005-12345 with the number supplied to you
%% by ASME for your paper.
\papernum{DSCC2008-12345}

\title{System identification of a bicycle under manual control and lateral
perturbations}

\author{Jason K. Moore\thanks{Address all correspondence to this author.}, {\tensfb Mont Hubbard}, {\tensfb Ronald Hess} \\
    \affiliation{
    Department of Mechanical and Aerospace Engineering\\
    University of California\\
    Davis, California 95616\\
    Email: jkmoor@ucdavis.edu, mhubbard@ucdavis.edu, rahess@ucdavis.edu
    }
}

\begin{document}
%\pagestyle{empty}

\maketitle

\begin{abstract}
	\textit{We compare two fourth order bicycle models derived from first
	principles to a set of empirically derived fourth order linear models. The
	empirical models were developed by using system idenfication techniques with
	a structred state space model. The data was collected during a series of
	experiments on a gymnasium floor and a large treadmill. During the
	experiments, three rigidified bicycle riders manually controlled the bicycle
	using only steering control for two tasks: heading tracking, line tracking,
	and both tasks with measured lateral pulsive perturbations. The bicycle was
	instrumented to accurately measure the rider’s applied steering torque, all
	of the essential kinematics of the bicycle’s motion, and the lateral
	perturbation force. The resulting the rider control actions excited the
	system in a bandwidth adequate for identifying the linear dynamics of the
	bicycle with standard state space system identification techniques. The
	resulting models were compared with several archetypal models using a custom
	interactive program allowing the comparison of the emprically derived models
	to the first principles models, showing that the simplest bicycle models are
	not necessarily sufficient for capturing the fundamental dynamics of the
	vehicle.  The roll acceleration equation was found to be reasonably predicted
	by the simpler first principles bicycle models, but the steer acceleration
	equation was not. A model which includes the inertial effects of the rider’s
	arms, which more closely modeled reality, improved the model predictions, but
	still lacked full fidelity. We conclude the paper by exploring the validity
	of several of the modeling assumptions and potential sources for the error,
	with a particular focus on the tire to floor interaction.}
\end{abstract}
\section*{INTRODUCTION}

There is a rich history of bicycle and motorcycle mathematical model
development which has been able to explain many of the more dynamically
fascinating phenomena from countersteering and stability to speedman's wobble
and gyroscopic effects \cite{Limebeer2006, Meijaard2007, Meijaard2011}, but the
amount of experimental validation of these idealized models pales in
comparison, with the motorcycle experimentation just outdistancing that done with
bicycles.

The earliest comprehensive bicycle model validation began at CALSPAN in the
late 60's \cite{Roland1971}. They made use of a rocket to apply know step
torques to an uncontrolled riderless bicycle while measuring the roll rate and
steer angle of the bicycle. The also simulated slalom maneuvers and visually
compared the results with video footage of a person performing the maneuvers.
The results were compared with computer simulations in a visual manner and
basic agreement was found. Kooijman \cite{Kooijman2006, Kooijman2009}
made use of an uncontrolled riderless bicycle's stability and excited the weave
mode showing good agreement with the eigenvalues of linearized Whipple model.
His experiments have been repeated by both \cite{Stevens2009} and
\cite{Escolona2011} with some repeatability, but not enough to negate more the
need for more experimentation. Chen and Doa \cite{Chen2010} make use of a
structured black box identification of simulated noisy data and were able to
basically reproduce the eigenvalues of a Whipple model. 

David Eaton identified a motorcycle with both spectral techniques and basic
regression techniques in his 1973 dissertation \cite{Eaton1973}. He did
experiments with an uncontrolled motorcycle with rigidified rider between speeds
6.7 and 20 m/s and excited the system by tapping the handlebars and releasing
weights for a change in roll torque. He compared Bode plots and time
simulations of a slightly modified version of Sharp's early model
\cite{Sharp1971} with good prediction of the weave and capsize modes, but he
concluded that a different tire model was needed to predict the wobble mode. He
was also able to estimate the motorcycle model from the spectral content of the
measured steer torque and roll angle while the motorcycle was manually
controlled by the rider with a bandwidth of 1-4 rad/s.  Eaton's methods laid
the groundwork and structure for many subsequent studies by other researchers.

Stephen James \cite{James2002} identified an off road motorcycle which was
manually excited by the rider using black box ARX methods for a 6th and 7th
order model with the measured steer torque and the steer angle, roll rate and
yaw rate. The compared the experimental results with a 10th order first
principles motorcycle model he developed and claimed good agreement based on
visual interpretation of the root loci plots. He notes that the system can be
excited adequately with manual control only. Biral et al \cite{Biral2003}
constructed experimental Bode plots of a motorcycle under manual control from
steer torque and kinematic data during a series of slalom tests which forced
rider to employ sinusoidal inputs. They were able to get very good agreement
with their motorcycle model and showed how their model better predicted the
data than models with less fidelity. Doria et al
\cite{Doria2012} excited the weave mode of a motorcycle at high speed with a
handlebar tap by the rider and was able to show agreement to their motorcycle
model through a phase portrait view.

Basic bicycle and motorcycle identification is typically done by exciting the
vehicle through either perturbations in roll or steer. These experiments can be
done when the bicycle is under closed loop control and/or when the bicycle is
stable, the former being requirement for speeds outside of the stable speed
range.  The mode excitation methods are limited to the frequency band around
that mode of motion, making it difficult to identify other modes.  Manual
excitation under closed loop control allows more of the primary modes to be
identified in each experiment. The application of modern system identification
techniques can help make your models super duper.

\section*{MEASUREMENTS}
We constructed an instrumented bicycle with a wide variety of kinematic and
kinetic sensors. The bicycle is a heavily modified normal steel bicycle. The
rider's torso was rigidified with respect to the bicycle frame with the use of
a torso cast. The rider's legs were fixed to the frame with magnetic knee
straps and pedaling was not required by adding an electric motor for
propulsion. The rider's head and arms were able to move, the latter for
steering control. Great care was taken to measure steer torque as accurately as
possible. We made use of a 150 in-lb single axis torque sensor mounted such
that it was impossible to apply any forces or moments besides the steer torque.
The steer angle and roll angle were measured with potentiometers, the later
through the roll rotation of a lightweight trailer. The three dimensional
angular rates of the bicycle frame and the acceleration of a point on the frame
were measured with an inertial measurement unit. The body fixed rate of the
front frame about the steer axis was measured with a rate gyro. The lateral
perturbations delivered by a push/pull rod where measured with a 450 N load
cell.

The raw voltage signals were collected on-board via a data acquisition unit and
a netbook laptop with a Matlab interface. A processing program, was developed to
create and manage an HDF5 database of all of the signal data and accompanying
metadata for each run. The software allows for easy querying, converts raw
voltage signals to the properly scaled engineering units, computes the desired
quantities for model comparison, and filters and truncates the signals
depending on the task for selecting the best data for identification purposes.
Figure \ref{fig:coefficients} shows an example of the processed experimental
data for one run.

\section*{EXPERIMENTS}
We collected data with three riders (C, J, L) of similar age (34, 28-29, 32),
mass (79, 84 , 84 kg), height () and proficiency in bicycling ability for a
series of experiments. The data presented herein focuses on four tasks:

\begin{description}
	\item[Balance]
		The rider was instructed to simply balance the bicycle and keep a
		relatively straight heading while focusing their vision at a point in the
		far distance.
	\item[Balance With Disturbance]
		The same instructions were given as in the Balance task except that a
		lateral force perturbation is applied just under the seat of the bicycle in
		both a random direction and at a random time.
	\item[Track Straight Line]
		The rider was instructed to focus on a straight line that was marked on the
		ground and attempt to keep the front wheel on the line.
	\item[Track Straight Line With Disturbance]
		This task was the same as "Track Straight Line" except that a lateral
		perturbation force is applied to the seat of the bicycle. This was done in
		the same fashion as described in "Balance With Disturbance".
\end{description}

We performed the experiments on the treadmill and in a large gymnasium. The
treadmill is 1 meter wide by 5 meters long and has a speed range from 0.5 m/s
to 17 m/s. The treadmill surface was made of finely grooved rubber. The
treadmill was narrow but after some practice we were able to successfully
perform the lateral perturbations experiments. This provided a very controlled
environment, in particular with respect to fixed speeds and allowed for very
long runs durations within a broad speed range.

Because all of the bicycle's data collection equipment was on board we were
able to also perform the experiments on a gymnasium floor. The floor was made
of a smooth stiff rubber and provided a rectangular wind free space of about 30
m by 55 m. We road around the perimeter to build up speed and did our maneuvers
on a straight section about 30 m long. We were not able to travel at speeds
higher than about 7 m/s due to the tires slipping in the final turn into the
test section.

\section*{FIRST PRINCIPLE MODELS}
The passive dynamics of the bicycle rider system can be described with a
infinite number of models. The Whipple model \cite{Whipple1899} provides a
somewhat minimalistic model capable of capturing the essential dynamics of a
bicycle/rider system. We use this model as the standard base model to work
from, as the fidelity of simpler models are not adequate and this model has
been benchmarked in \cite{Meijaard2007,Basu-Mandal2007}. The model is 4th order
with roll angle, steer angle, roll rate and steer rate as the states and
typically a roll torque and steer torque as the inputs. We neglect the roll
torque input and in its place extend the model such that a lateral force acting
at a point on the frame provides as a new input, to accurately model the
lateral perturbations. The second model that we consider adds the inertial
effects of the rider's arms because we let the riders move their arms along
with the front frame of the bicycle. We extend the model in a similar fashion
as the upright rider in \cite{Schwab2012}, except with slightly different joint
definitions.  Constraints are then chosen such that no extra degrees of freedom
are added to the bicycle/rider model to keep the system both tractable and
comparable to the benchmarked Whipple model.

We populate the linear model coefficients using measured parameters of the
bicycle and rider. The bicycle was measured as described in \cite{Moore2010} to
get accurate estimates of the parameters used in the benchmark bicycle.
Additional measures for the lateral force application point were also included.
Each rider's inertial properties were estimated with Yeadon's method
\cite{Yeadon1990a} and allowed easy extraction of body segment parameters for
more complicated rider biomechanic models such as the inclusion of moving arms
as described above. The parameter computation is handled with a two custom open
source software packages \cite{Moore2011a,Dembia2011}.

\section*{MODEL IDENTIFICATION}
Each run provided a collection of time series that describe the various inputs
and outputs of the system. For this analysis, we limit our inputs to steer
torque and lateral force and our outputs to roll angle, steer angle, roll rate
and steer rate. This ideal fourth order system can be described by the
following continuous state space description.

\begin{equation}
	\begin{split}
		\dot{x}(t) & =
		\mathbf{F}x(t) + \mathbf{G}u(t)\\
		\begin{bmatrix}
			\dot{\phi} \\
			\dot{\delta} \\
			\ddot{\phi} \\
			\ddot{\delta}
		\end{bmatrix}
		& =
		\begin{bmatrix}
			0 & 0 & a_{\dot{\phi}\phi} & 0\\
			0 & 0 & 0 & a_{\dot{\delta}\delta}\\
			a_{\ddot{\phi}\phi} & a_{\ddot{\phi}\delta} &
			a_{\ddot{\phi}\dot{\phi}} & a_{\ddot{\phi}\dot{\delta}}\\
			a_{\ddot{\delta}\phi} & a_{\ddot{\delta}\delta} &
			a_{\ddot{\delta}\dot{\phi}} & a_{\ddot{\delta}\dot{\delta}}
		\end{bmatrix}
		\begin{bmatrix}
			\phi \\
			\delta \\
			\dot{\phi} \\
			\dot{\delta}
		\end{bmatrix}
		+
		\begin{bmatrix}
			0 & 0 \\
			0 & 0\\
			b_{\ddot{\phi}T_\delta} & b_{\ddot{\phi}F_{c_l}}\\
			b_{\ddot{\delta}T_\delta} & b_{\ddot{\delta}F_{c_l}}
		\end{bmatrix}
		\begin{bmatrix}
			T_\delta\\
			F_{c_l}
		\end{bmatrix}
	\end{split}
\end{equation}

\begin{equation}
	\begin{split}
		\eta(t) & = \mathbf{H}x(t)\\
		\begin{bmatrix}
			\phi \\
			\delta \\
			\dot{\phi} \\
			\dot{\delta}
		\end{bmatrix}
		& =
		\begin{bmatrix}
			1 & 0 & 0 & 0 \\
			0 & 1 & 0 & 0 \\
			0 & 0 & 1 & 0 \\
			0 & 0 & 0 & 1
		\end{bmatrix}
		\begin{bmatrix}
			\phi \\
			\delta \\
			\dot{\phi} \\
			\dot{\delta}
		\end{bmatrix}
	\end{split}
\end{equation}

Assuming that this model structure can adequately capture the dynamics of
interest in the bicycle/rider system, our goal is to accurately identify the
unknown parameters $\theta$ which are made up of all or a subset of the
unspecified entries in the $\mathbf{F}$ and $\mathbf{G}$ matrices. This
continuous formulation is not easily used with noisy discrete data and the
following difference equation can be assumed if we sample at $t=kT$,
$k=1,2,\cdots$ and that the values are constant over the sample period.

\begin{equation}
	\begin{split}
		x(kT + T) & = \mathbf{A}(\theta)x(kT) + \mathbf{B}(\theta)u(kT) + w(kT)\\
		y(kT) & = \mathbf{C}(\theta)x(kT) + v(kT)
	\end{split}
\end{equation}

Where $w$ is the process noise which we assume is zero and $v$ is the
measurement noise, which is assumed to be white and Gaussian with zero mean and
known variance. The $\mathbf{A}$ and $\mathbf{B}$ matrices are related to
$\mathbf{F}$ and $\mathbf{G}$ by

\begin{equation}
	\begin{split}
		\mathbf{A}(\theta) & = e^{\mathbf{F}(\theta)T}\\
		\mathbf{B}(\theta) & = \int_{\tau=0}^T e^{\mathbf{F}(\theta)\tau}
		\mathbf{G}(\theta) d\tau
	\end{split}
\end{equation}

We made use of the Matlab System Idenfication Toolbox for the identifcation of
the parameters $\theta$ in each run of this output error model structure.

Figure \ref{fig:exampleFit} shows the example input and output data for a
single run with both steer torque and lateral force as inputs. Notice that the
identified model predicts the trajecotry extremely well and similar results are
found for the majority of the runs. The Whipple model predicts the trajectory
directions but the magnitudes are large, meaning that for a given trajectory,
the Whipple model requires less torque than what was measured. The Whipple
model with the arm inertial effects does a better job than the Whipple model,
but still has some magnitude differences.

\begin{figure}
	\includegraphics{figures/example-fit.pdf}
	\caption{The example results for the identification of a single run. The
	experimentally measured steer torque and lateral force are shown in the top
	two graphs. All of the signals were filtered with a 2nd order 15 hertz low
	pass Butterworth filter. The remaining four graphs show the simulation
	results for the Whipple model (W), Whipple model with the arm inertia (A),
	and the identified model for that run (I) plotted with the measured data (M).
	The percentages give the percent of variance explained by the model.}
	\label{fig:exampleFit}
\end{figure}

\section*{MODEL COMPARISON}
We run the identification procedure described in the previous section for a
collection of runs ($n=368$) over a range of speeds between about 1 and 9 m/s.
Figure \ref{fig:coefficients} plots the identified coefficients of the
dynamical equations of motion (i.e. the bottom two rows of the \(\mathbf{F}\)
and \(\mathbf{G}\) matrices) as a function of speed for each run as compared to
both the Whipple model prediction and the arm model prediction. From visual
inspection the $\ddot{phi}$ equation seems to be better predicted by the two
models. The roll equation also seems to have less spread in the experimental data. For
example, the \(a_{\ddot{\phi}\delta}\) coefficient appears to be very tight and the
first principles models predict it very well. The constant, linear and
quadratic trends in the coefficients are not easily seen for most coefficients
due to the high number of repeated experiments at some speeds.

Figure \ref{fig:bode} gives another view of the resulting data. It is a
frequency response plot at the mean speed for a set of runs. The blue lines
give the mean and standard deviation of the magnitude and phase of the system
transfer function \(\frac{\phi(s)}{T_\delta(s)}\). Even though the spread in
the identified parameters seems high in Figure \ref{fig:coefficients}, the Bode
plot shows that the system response isn't as variable, especially in magnitude.
It is also apparent that the experimental magnitude has a -5 to -10 dB offset
across the frequency range shown with respect to the Whipple model. This
explains the amplitude differences in the trajectories shown in
\ref{fig:exampleFit}. Notice that the arm model has little to no offset between
2 and 10 rad/s.

\begin{figure*}
	\includegraphics{figures/coefficients.pdf}
	\caption{The coefficients of the linear dynamical equations of motion plotted
	as a function of speed. Each blue dot is a single experiment. The green line
	is the Whipple model and the magenta line is the Arm model. Only experiments
	with a mean fit percentage greater than zero are shown.}
	\label{fig:coefficients}
\end{figure*}

\begin{figure}
	\includegraphics{figures/bode.pdf}
	\caption{The frequency response of the steer torque to roll angle transfer
	function for a set of runs at $4.0 \pm 0.3$ m/s. The solid blue line is the
	mean from the identified runs and is bounded by the standard deviation, the
	dotted blue line. The red line is the Whipple model and the green line is the
	from the arm extension.}
	\label{fig:bode}
\end{figure}

\section*{CONCLUSION}
We have shown that a fourth order structured state space model is adequate for
describing the motion of the bicycle under manual control in a speed range from
approximately 1.5 m/s to 9 m/s. The fact that higher order models may not be
necessary for bicycle dynamic description is an important finding, but the
data subsequently reveals that archetypal first principles models are not
robust enough to fully describe the dynamics. The difficenices are most
probably due to the knife edge, no side slip assumptions made in the two
models. We found thatthe uncertaintiy in our model physical parameter estimates
were not large enough to cause the models to better predict the data. It is
more likely that a tire scrub torques of some sort are needed to improve the
fidelity.

\begin{acknowledgment}
	This material is based upon work supported by the National Science Foundation
	under Grant No 0928339.
\end{acknowledgment}

\bibliographystyle{asmems4}
\bibliography{bicycle}

\end{document}
